<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multimedia Base64 Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              cyan: {
                400: '#22d3ee',
                500: '#06b6d4',
                600: '#0891b2',
                700: '#0e7490',
              },
              slate: {
                200: '#e2e8f0',
                400: '#94a3b8',
                600: '#475569',
                700: '#334155',
                800: '#1e293b',
                900: '#0f172a',
              }
            }
          }
        }
      }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
</head>
<body class="bg-slate-900 text-slate-200 antialiased">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useCallback, useRef } from 'react';
        import ReactDOM from 'react-dom/client';

        // --- Component: Preview ---
        const Preview = ({ src, mimeType }) => {
          if (!src || !mimeType) {
            return null;
          }

          const mediaType = mimeType.split('/')[0];

          switch (mediaType) {
            case 'image':
              return <img src={src} alt="Preview" className="max-w-full max-h-80 mx-auto rounded-lg object-contain" />;
            case 'audio':
              return <audio controls src={src} className="w-full">Your browser does not support the audio element.</audio>;
            case 'video':
              return <video controls src={src} className="max-w-full max-h-80 mx-auto rounded-lg">Your browser does not support the video tag.</video>;
            default:
              return (
                <div className="text-center text-amber-400 p-4 border border-amber-400/50 rounded-lg bg-amber-900/20">
                  <p className="font-semibold">Unsupported Preview</p>
                  <p className="text-sm mb-2">Could not render a preview for type: <span className="font-mono">{mimeType}</span></p>
                  <a href={src} download="decoded-file" className="text-cyan-400 hover:underline mt-2 inline-block text-sm font-medium">
                    Try to download the file instead
                  </a>
                </div>
              );
          }
        };

        // --- Component: Encoder ---
        const Encoder = () => {
            const MAX_FILE_SIZE_MB = 50;
            const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024;

            const fileToBase64 = (file) => {
              return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
              });
            };

            const CopyIcon = ({className}) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className || "h-5 w-5"} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                    <path strokeLinecap="round" strokeLinejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
            );

            const CheckIcon = ({className}) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className || "h-5 w-5"} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                    <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" />
                </svg>
            );
            
            const [file, setFile] = useState(null);
            const [previewSrc, setPreviewSrc] = useState('');
            const [base64, setBase64] = useState('');
            const [isCopied, setIsCopied] = useState(false);
            const [error, setError] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const fileInputRef = useRef(null);

            const handleFileChange = useCallback(async (selectedFile) => {
                if (!selectedFile) return;

                setError('');
                if (selectedFile.size > MAX_FILE_SIZE_BYTES) {
                    setError(`File is too large. Maximum size is ${MAX_FILE_SIZE_MB}MB.`);
                    return;
                }

                setFile(selectedFile);
                setIsLoading(true);

                const objectUrl = URL.createObjectURL(selectedFile);
                setPreviewSrc(objectUrl);

                try {
                    const base64String = await fileToBase64(selectedFile);
                    setBase64(base64String);
                } catch (err) {
                    setError('Failed to read and convert file.');
                    console.error(err);
                } finally {
                    setIsLoading(false);
                }
            }, []);

            const onFileInputChange = (e) => {
                handleFileChange(e.target.files ? e.target.files[0] : null);
            };
            
            const onDrop = (e) => {
                e.preventDefault();
                e.currentTarget.classList.remove('border-cyan-500', 'bg-slate-700/50');
                handleFileChange(e.dataTransfer.files ? e.dataTransfer.files[0] : null);
            };

            const onDragOver = (e) => {
                e.preventDefault();
                e.currentTarget.classList.add('border-cyan-500', 'bg-slate-700/50');
            };
            
            const onDragLeave = (e) => {
                e.preventDefault();
                e.currentTarget.classList.remove('border-cyan-500', 'bg-slate-700/50');
            };

            const handleCopy = () => {
                if (!base64) return;
                navigator.clipboard.writeText(base64).then(() => {
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2500);
                });
            };
            
            const formatBytes = (bytes, decimals = 2) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
            };

            return (
                <div className="space-y-6">
                    <input
                        type="file"
                        ref={fileInputRef}
                        onChange={onFileInputChange}
                        className="hidden"
                        accept="image/*,video/*,audio/*"
                    />
                    <div
                        className="flex justify-center items-center w-full"
                        onDrop={onDrop}
                        onDragOver={onDragOver}
                        onDragLeave={onDragLeave}
                    >
                        <div
                            onClick={() => fileInputRef.current?.click()}
                            className="flex flex-col items-center justify-center w-full h-64 border-2 border-slate-600 border-dashed rounded-lg cursor-pointer bg-slate-800/50 hover:bg-slate-700/50 transition-colors duration-300"
                        >
                            <div className="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg className="w-8 h-8 mb-4 text-slate-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                    <path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                </svg>
                                <p className="mb-2 text-sm text-slate-400"><span className="font-semibold">Click to upload</span> or drag and drop</p>
                                <p className="text-xs text-slate-500">Image, Audio, or Video (MAX. {MAX_FILE_SIZE_MB}MB)</p>
                            </div>
                        </div>
                    </div>

                    {error && <p className="text-red-400 text-center">{error}</p>}
                    
                    {file && (
                        <div className="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                            <h3 className="text-lg font-semibold mb-3 text-slate-300">Preview</h3>
                            <div className="mb-2 text-sm text-slate-400">
                              <strong>File:</strong> {file.name} ({formatBytes(file.size)})
                            </div>
                            <div className="flex justify-center items-center p-2 rounded-md bg-slate-900 min-h-[10rem]">
                               <Preview src={previewSrc} mimeType={file.type} />
                            </div>
                        </div>
                    )}

                    {(isLoading || base64) && (
                      <div className="space-y-2">
                          <div className="flex justify-between items-center">
                            <label htmlFor="base64-output" className="font-semibold text-slate-300">Base64 Output</label>
                            {base64 && (
                              <button onClick={handleCopy} className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-sm text-slate-200 font-medium py-1.5 px-3 rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-slate-800">
                                  {isCopied ? <><CheckIcon className="h-5 w-5 text-green-400"/> Copied!</> : <><CopyIcon className="h-5 w-5"/> Copy</>}
                              </button>
                            )}
                          </div>
                          <textarea
                              id="base64-output"
                              readOnly
                              value={isLoading ? 'Converting file...' : base64}
                              className="w-full h-48 p-3 font-mono text-sm bg-slate-900 border border-slate-700 rounded-md focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors"
                              placeholder="Your Base64 code will appear here..."
                          />
                      </div>
                    )}
                </div>
            );
        };

        // --- Component: Decoder ---
        const Decoder = () => {
            const [base64Input, setBase64Input] = useState('');
            const [decodedMedia, setDecodedMedia] = useState(null);
            const [error, setError] = useState('');

            const handleDecode = () => {
                setError('');
                setDecodedMedia(null);

                if (!base64Input.trim()) {
                    setError('Please paste a Base64 data URL string.');
                    return;
                }
                
                if (!base64Input.startsWith('data:')) {
                    setError('Invalid format. The string must be a data URL (starts with "data:").');
                    return;
                }

                try {
                    const mimeTypeMatch = base64Input.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+);base64,/);
                    if (!mimeTypeMatch || !mimeTypeMatch[1]) {
                        setError('Could not determine the MIME type from the data URL.');
                        return;
                    }
                    const mimeType = mimeTypeMatch[1];
                    setDecodedMedia({ src: base64Input, mimeType });
                } catch (e) {
                    setError('An unexpected error occurred while processing the string.');
                    console.error(e);
                }
            };

            return (
                <div className="space-y-6">
                    <div className="space-y-2">
                        <label htmlFor="base64-input" className="font-semibold text-slate-300">
                            Paste Base64 Data URL
                        </label>
                        <textarea
                            id="base64-input"
                            value={base64Input}
                            onChange={(e) => setBase64Input(e.target.value)}
                            className="w-full h-48 p-3 font-mono text-sm bg-slate-900 border border-slate-700 rounded-md focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors"
                            placeholder="data:image/png;base64,iVBORw0KGgo..."
                        />
                    </div>
                    
                    <div className="text-center">
                        <button
                            onClick={handleDecode}
                            className="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2.5 px-6 rounded-lg transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-cyan-500/50 transform hover:scale-105 active:scale-100 disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled={!base64Input}
                        >
                            Decode & Preview
                        </button>
                    </div>

                    {error && <p className="text-red-400 text-center bg-red-900/20 p-3 rounded-md">{error}</p>}
                    
                    {decodedMedia && (
                        <div className="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                            <h3 className="text-lg font-semibold mb-3 text-slate-300">Decoded Preview</h3>
                            <div className="flex justify-center items-center p-2 rounded-md bg-slate-900 min-h-[10rem]">
                                <Preview src={decodedMedia.src} mimeType={decodedMedia.mimeType} />
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Component: App ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('encode');

            const renderTabContent = () => {
                switch (activeTab) {
                    case 'encode':
                        return <Encoder />;
                    case 'decode':
                        return <Decoder />;
                    default:
                        return null;
                }
            };

            const TabButton = ({ tab, children }) => {
                const isActive = activeTab === tab;
                return (
                    <button
                        onClick={() => setActiveTab(tab)}
                        className={`px-4 sm:px-6 py-3 font-semibold text-base sm:text-lg outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-slate-900 rounded-t-md transition-all duration-300 ${
                            isActive
                                ? 'text-cyan-400 border-b-2 border-cyan-400'
                                : 'text-slate-400 hover:text-slate-200'
                        }`}
                    >
                        {children}
                    </button>
                );
            };

            return (
                <div className="min-h-screen container mx-auto p-4 sm:p-6 lg:p-8">
                    <header className="text-center mb-8 sm:mb-12">
                        <h1 className="text-3xl sm:text-4xl lg:text-5xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-slate-200">
                            Multimedia Base64 Converter
                        </h1>
                        <p className="mt-2 text-slate-400 text-lg">Encode files to Base64 and decode Base64 strings back to files.</p>
                    </header>

                    <main className="max-w-4xl mx-auto">
                        <div className="flex justify-center mb-6 border-b border-slate-700">
                            <TabButton tab="encode">Encode</TabButton>
                            <TabButton tab="decode">Decode</TabButton>
                        </div>
                        
                        <div className="bg-slate-800/50 p-6 sm:p-8 rounded-xl shadow-2xl border border-slate-700">
                           {renderTabContent()}
                        </div>
                    </main>
                     <footer className="text-center mt-12 text-slate-600">
                        <p>Base64 Converter</p>
                    </footer>
                </div>
            );
        };

        // --- Root rendering logic ---
        const rootElement = document.getElementById('root');
        if (!rootElement) {
          throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
</body>
</html>
